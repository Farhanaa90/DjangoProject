{% extends 'base.html' %}

{% block content %}
<div class="container mx-auto px-4 py-10">
    <div class="max-w-2xl mx-auto bg-white shadow-lg rounded-lg p-8">
        <h2 class="text-3xl font-bold text-gray-800 mb-6">Edit Profile</h2>

        <form method="POST" enctype="multipart/form-data" class="space-y-4">
            {% csrf_token %}

            <div class="text-center mb-6">
                <div class="mb-4">
                    {% if user_profile.profile_picture %}
                        <img id="preview" src="{{ user_profile.profile_picture.url }}" alt="Profile Picture"
                             class="w-32 h-32 rounded-full object-cover border-4 border-blue-600 mx-auto">
                    {% else %}
                        <img id="preview" src="" alt="Preview"
                             class="w-32 h-32 rounded-full object-cover border-4 border-blue-600 mx-auto hidden">
                        <div id="placeholder" class="bg-blue-600 text-white rounded-full w-32 h-32 flex items-center justify-center text-5xl font-bold mx-auto">
                            {{ user.username|slice:":1"|upper }}
                        </div>
                    {% endif %}
                </div>

                <label class="inline-block">
                    <span class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded cursor-pointer transition">
                        Choose Picture
                    </span>
                    <input type="file" name="profile_picture" id="pictureInput" accept="image/*" class="hidden" onchange="previewImage(event)">
                </label>
            </div>

            <div>
                <label class="block text-gray-700 font-medium mb-2">Full Name</label>
                <input type="text" name="name" value="{{ user.first_name }}"
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>

            <div>
                <label class="block text-gray-700 font-medium mb-2">Email</label>
                <input type="email" name="email" value="{{ user.email }}"
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>

            <div>
                <label class="block text-gray-700 font-medium mb-2">Phone</label>
                <input type="text" name="phone" value="{{ user_profile.phone }}"
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                       placeholder="Enter phone number">
            </div>

            <div>
                <label class="block text-gray-700 font-medium mb-2">City</label>
                <input type="text" name="city" value="{{ user_profile.city }}"
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                       placeholder="Enter your city">
            </div>

            <div>
                <label class="block text-gray-700 font-medium mb-2">Address</label>
                <textarea name="address" rows="3"
                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                          placeholder="Enter your address">{{ user_profile.address }}</textarea>
            </div>

            <div class="flex gap-4">
                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded transition">
                    Save Changes
                </button>
                <a href="{% url 'profile' %}" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded transition inline-block text-center">
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<script>
function previewImage(event) {
    const file = event.target.files[0];
    const preview = document.getElementById('preview');
    const placeholder = document.getElementById('placeholder');

    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            preview.classList.remove('hidden');
            if(placeholder) {
                placeholder.classList.add('hidden');
            }
        }
        reader.readAsDataURL(file);
    }
}
</script>
{% endblock %}